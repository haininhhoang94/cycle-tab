<!DOCTYPE html>
<html>

<head>
  <script src="/static/powerbi.min.js"></script>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      width: 100vw;
      overflow: hidden;
    }

    #reportContainer {
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      transition: opacity 0.6s cubic-bezier(0.77, 0, 0.175, 1);
      will-change: opacity;
      background: #146460;
      z-index: 1;
      opacity: 1;
    }

    .fade-out {
      opacity: 0;
      z-index: 2;
    }
  </style>
</head>

<body>
  <div id="reportContainer"></div>

  <script>
    const models = window['powerbi-client'].models;

    const config = {
      type: 'report',
      tokenType: models.TokenType.Aad,  // AAD = Delegated
      accessToken: "{{ embed_token }}", // from backend (MSAL)
      embedUrl: "{{ embed_url }}",      // Power BI report URL
      id: "{{ report_id }}",
      permissions: models.Permissions.All,
      settings: {
        panes: {
          filters: { visible: false },
          pageNavigation: { visible: false } // Hide navigation tabs
        },
        navContentPaneEnabled: false // Hide report tabs (chromeless)
      }
    };

    const reportContainer = document.getElementById("reportContainer");
    const report = powerbi.embed(reportContainer, config);

    // Helper to create a fade overlay
    function createFade() {
      const fade = document.createElement("div");
      fade.className = "slide";
      reportContainer.appendChild(fade);
      return fade;
    }

    // Auto-cycle through report pages every 10 seconds
    report.on("loaded", function () {
      report.getPages().then(function (pages) {
        let currentPage = 0;
        function switchToNextPage() {
          // Create overlay fade effect
          const fade = createFade();
          setTimeout(() => {
            fade.classList.add("fade-out");
            currentPage = (currentPage + 1) % pages.length;
            report.setPage(pages[currentPage].name);
            setTimeout(() => {
              reportContainer.removeChild(fade);
              setTimeout(switchToNextPage, 10000); // 10 seconds
            }, 600); // match transition duration
          }, 10); // allow DOM to render fade
        }
        // Start cycling after initial render
        setTimeout(switchToNextPage, 10000); // 10 seconds
      });
    });
  </script>
</body>

</html>
