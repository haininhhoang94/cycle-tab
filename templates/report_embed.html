<!DOCTYPE html>
<html>

<head>
  <script src="/static/powerbi.min.js"></script>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
    }

    #reportContainer {
      width: 100vw;
      height: 100vh;
      position: relative;
      transition: transform 0.6s cubic-bezier(0.77, 0, 0.175, 1);
      will-change: transform;
    }

    .swipe-out {
      transform: translateX(-100vw);
    }

    .swipe-in {
      transform: translateX(0);
    }
  </style>
</head>

<body>
  <div id="reportContainer"></div>

  <script>
    const models = window['powerbi-client'].models;

    const config = {
      type: 'report',
      tokenType: models.TokenType.Aad,  // AAD = Delegated
      accessToken: "{{ embed_token }}", // from backend (MSAL)
      embedUrl: "{{ embed_url }}",      // Power BI report URL
      id: "{{ report_id }}",
      permissions: models.Permissions.All,
      settings: {
        panes: {
          filters: { visible: false },
          pageNavigation: { visible: false } // Hide navigation tabs
        },
        navContentPaneEnabled: false // Hide report tabs (chromeless)
      }
    };

    const reportContainer = document.getElementById("reportContainer");
    const report = powerbi.embed(reportContainer, config);

    // Auto-cycle through report pages every 30 seconds
    report.on("loaded", function () {
      report.getPages().then(function (pages) {
        let currentPage = 0;
        function switchToNextPage() {
          // Animate swipe out
          reportContainer.classList.add("swipe-out");
          setTimeout(() => {
            currentPage = (currentPage + 1) % pages.length;
            report.setPage(pages[currentPage].name).then(() => {
              report.once("rendered", function () {
                // Animate swipe in
                reportContainer.classList.remove("swipe-out");
                reportContainer.classList.add("swipe-in");
                setTimeout(() => {
                  reportContainer.classList.remove("swipe-in");
                  setTimeout(switchToNextPage, 10000); // 10 seconds
                }, 600); // match transition duration
              });
            });
          }, 600); // match transition duration
        }
        // Start cycling after initial render
        report.once("rendered", function () {
          setTimeout(switchToNextPage, 10000); // 10 seconds
        });
      });
    });
  </script>
</body>

</html>
